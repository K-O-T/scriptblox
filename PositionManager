--TYSM Deepseek
--1.11 (Scaling Bugfix)

local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")

-- Основной GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PositionManager"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = Player.PlayerGui

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 300, 0, 400)
MainFrame.Position = UDim2.new(0, 50, 0, 50)
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = MainFrame

-- Элементы для растягивания
local resizeHandles = {}
local resizeCorners = {
    {name = "TopLeft", position = UDim2.new(0, -5, 0, -5), size = UDim2.new(0, 10, 0, 10), cursor = "SizeNWSE"},
    {name = "TopRight", position = UDim2.new(1, -5, 0, -5), size = UDim2.new(0, 10, 0, 10), cursor = "SizeNESW"},
    {name = "BottomLeft", position = UDim2.new(0, -5, 1, -5), size = UDim2.new(0, 10, 0, 10), cursor = "SizeNESW"},
    {name = "BottomRight", position = UDim2.new(1, -5, 1, -5), size = UDim2.new(0, 10, 0, 10), cursor = "SizeNWSE"},
    {name = "Top", position = UDim2.new(0, 5, 0, -5), size = UDim2.new(1, -10, 0, 10), cursor = "SizeNS"},
    {name = "Bottom", position = UDim2.new(0, 5, 1, -5), size = UDim2.new(1, -10, 0, 10), cursor = "SizeNS"},
    {name = "Left", position = UDim2.new(0, -5, 0, 5), size = UDim2.new(0, 10, 1, -10), cursor = "SizeEW"},
    {name = "Right", position = UDim2.new(1, -5, 0, 5), size = UDim2.new(0, 10, 1, -10), cursor = "SizeEW"}
}

for _, cornerData in ipairs(resizeCorners) do
    local handle = Instance.new("Frame")
    handle.Name = cornerData.name
    handle.Size = cornerData.size
    handle.Position = cornerData.position
    handle.BackgroundTransparency = 1
    handle.ZIndex = 10
    handle.Parent = MainFrame
    
    local connection
    handle.MouseEnter:Connect(function()
        Mouse.Icon = "rbxasset://SystemCursors/" .. cornerData.cursor
    end)
    
    handle.MouseLeave:Connect(function()
        Mouse.Icon = "rbxasset://SystemCursors/Arrow"
    end)
    
    resizeHandles[cornerData.name] = handle
end

-- Заголовок для перемещения
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
TitleBar.BorderSizePixel = 0
TitleBar.ZIndex = 5
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 12)
TitleCorner.Parent = TitleBar

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Size = UDim2.new(0.7, 0, 1, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "Position Manager"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextSize = 14
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.ZIndex = 6
TitleLabel.Parent = TitleBar

local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -60, 0, 0)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Text = "_"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.TextSize = 16
MinimizeButton.ZIndex = 6
MinimizeButton.Parent = TitleBar

local MinimizeCorner = Instance.new("UICorner")
MinimizeCorner.CornerRadius = UDim.new(0, 6)
MinimizeCorner.Parent = MinimizeButton

local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -30, 0, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.BorderSizePixel = 0
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 12
CloseButton.ZIndex = 6
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

-- Контент
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, 0, 1, -30)
ContentFrame.Position = UDim2.new(0, 0, 0, 30)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- Секция сохранения позиции
local SaveSection = Instance.new("Frame")
SaveSection.Name = "SaveSection"
SaveSection.Size = UDim2.new(1, -20, 0, 100)
SaveSection.Position = UDim2.new(0, 10, 0, 10)
SaveSection.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
SaveSection.BorderSizePixel = 0
SaveSection.Parent = ContentFrame

local SaveSectionCorner = Instance.new("UICorner")
SaveSectionCorner.CornerRadius = UDim.new(0, 8)
SaveSectionCorner.Parent = SaveSection

local PositionNameBox = Instance.new("TextBox")
PositionNameBox.Name = "PositionNameBox"
PositionNameBox.Size = UDim2.new(1, -20, 0, 30)
PositionNameBox.Position = UDim2.new(0, 10, 0, 10)
PositionNameBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
PositionNameBox.BorderSizePixel = 0
PositionNameBox.PlaceholderText = "Position Name"
PositionNameBox.Text = ""
PositionNameBox.TextColor3 = Color3.fromRGB(255, 255, 255)
PositionNameBox.TextSize = 12
PositionNameBox.Parent = SaveSection

local PositionNameCorner = Instance.new("UICorner")
PositionNameCorner.CornerRadius = UDim.new(0, 6)
PositionNameCorner.Parent = PositionNameBox

local SaveButton = Instance.new("TextButton")
SaveButton.Name = "SaveButton"
SaveButton.Size = UDim2.new(1, -20, 0, 30)
SaveButton.Position = UDim2.new(0, 10, 0, 50)
SaveButton.BackgroundColor3 = Color3.fromRGB(60, 120, 60)
SaveButton.BorderSizePixel = 0
SaveButton.Text = "Save Current Position"
SaveButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SaveButton.TextSize = 12
SaveButton.Parent = SaveSection

local SaveButtonCorner = Instance.new("UICorner")
SaveButtonCorner.CornerRadius = UDim.new(0, 6)
SaveButtonCorner.Parent = SaveButton

-- Градиент для кнопки Save
local SaveButtonGradient = Instance.new("UIGradient")
SaveButtonGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(200, 200, 200))
})
SaveButtonGradient.Enabled = false
SaveButtonGradient.Parent = SaveButton

local SaveButtonStroke = Instance.new("UIStroke")
SaveButtonStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
SaveButtonStroke.Color = Color3.fromRGB(100, 200, 100)
SaveButtonStroke.Thickness = 0
SaveButtonStroke.Parent = SaveButton

-- Секция ручного ввода координат
local ManualSection = Instance.new("Frame")
ManualSection.Name = "ManualSection"
ManualSection.Size = UDim2.new(1, -20, 0, 130)
ManualSection.Position = UDim2.new(0, 10, 0, 120)
ManualSection.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
ManualSection.BorderSizePixel = 0
ManualSection.Parent = ContentFrame

local ManualSectionCorner = Instance.new("UICorner")
ManualSectionCorner.CornerRadius = UDim.new(0, 8)
ManualSectionCorner.Parent = ManualSection

local ManualLabel = Instance.new("TextLabel")
ManualLabel.Name = "ManualLabel"
ManualLabel.Size = UDim2.new(1, -20, 0, 20)
ManualLabel.Position = UDim2.new(0, 10, 0, 5)
ManualLabel.BackgroundTransparency = 1
ManualLabel.Text = "Manual Coordinates"
ManualLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
ManualLabel.TextSize = 12
ManualLabel.Font = Enum.Font.GothamBold
ManualLabel.Parent = ManualSection

local XBox = Instance.new("TextBox")
XBox.Name = "XBox"
XBox.Size = UDim2.new(0.3, 0, 0, 30)
XBox.Position = UDim2.new(0, 10, 0, 30)
XBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
XBox.BorderSizePixel = 0
XBox.PlaceholderText = "X"
XBox.Text = ""
XBox.TextColor3 = Color3.fromRGB(255, 255, 255)
XBox.TextSize = 12
XBox.Parent = ManualSection

local XBoxCorner = Instance.new("UICorner")
XBoxCorner.CornerRadius = UDim.new(0, 6)
XBoxCorner.Parent = XBox

local YBox = Instance.new("TextBox")
YBox.Name = "YBox"
YBox.Size = UDim2.new(0.3, 0, 0, 30)
YBox.Position = UDim2.new(0.33, 10, 0, 30)
YBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
YBox.BorderSizePixel = 0
YBox.PlaceholderText = "Y"
YBox.Text = ""
YBox.TextColor3 = Color3.fromRGB(255, 255, 255)
YBox.TextSize = 12
YBox.Parent = ManualSection

local YBoxCorner = Instance.new("UICorner")
YBoxCorner.CornerRadius = UDim.new(0, 6)
YBoxCorner.Parent = YBox

local ZBox = Instance.new("TextBox")
ZBox.Name = "ZBox"
ZBox.Size = UDim2.new(0.3, 0, 0, 30)
ZBox.Position = UDim2.new(0.66, 10, 0, 30)
ZBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
ZBox.BorderSizePixel = 0
ZBox.PlaceholderText = "Z"
ZBox.Text = ""
ZBox.TextColor3 = Color3.fromRGB(255, 255, 255)
ZBox.TextSize = 12
ZBox.Parent = ManualSection

local ZBoxCorner = Instance.new("UICorner")
ZBoxCorner.CornerRadius = UDim.new(0, 6)
ZBoxCorner.Parent = ZBox

local ManualNameBox = Instance.new("TextBox")
ManualNameBox.Name = "ManualNameBox"
ManualNameBox.Size = UDim2.new(1, -20, 0, 30)
ManualNameBox.Position = UDim2.new(0, 10, 0, 65)
ManualNameBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
ManualNameBox.BorderSizePixel = 0
ManualNameBox.PlaceholderText = "Position Name"
ManualNameBox.Text = ""
ManualNameBox.TextColor3 = Color3.fromRGB(255, 255, 255)
ManualNameBox.TextSize = 12
ManualNameBox.Parent = ManualSection

local ManualNameCorner = Instance.new("UICorner")
ManualNameCorner.CornerRadius = UDim.new(0, 6)
ManualNameCorner.Parent = ManualNameBox

local AddManualButton = Instance.new("TextButton")
AddManualButton.Name = "AddManualButton"
AddManualButton.Size = UDim2.new(1, -20, 0, 30)
AddManualButton.Position = UDim2.new(0, 10, 0, 100)
AddManualButton.BackgroundColor3 = Color3.fromRGB(60, 100, 150)
AddManualButton.BorderSizePixel = 0
AddManualButton.Text = "Add Manual Position"
AddManualButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AddManualButton.TextSize = 12
AddManualButton.Parent = ManualSection

local AddManualCorner = Instance.new("UICorner")
AddManualCorner.CornerRadius = UDim.new(0, 6)
AddManualCorner.Parent = AddManualButton

-- Градиент для кнопки Add Manual
local AddManualGradient = Instance.new("UIGradient")
AddManualGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(200, 200, 200))
})
AddManualGradient.Enabled = false
AddManualGradient.Parent = AddManualButton

local AddManualStroke = Instance.new("UIStroke")
AddManualStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
AddManualStroke.Color = Color3.fromRGB(80, 140, 200)
AddManualStroke.Thickness = 0
AddManualStroke.Parent = AddManualButton

-- Список позиций
local PositionsFrame = Instance.new("Frame")
PositionsFrame.Name = "PositionsFrame"
PositionsFrame.Size = UDim2.new(1, -20, 1, -270) -- Автоматически растягивается вниз
PositionsFrame.Position = UDim2.new(0, 10, 0, 260)
PositionsFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
PositionsFrame.BorderSizePixel = 0
PositionsFrame.Parent = ContentFrame

local PositionsFrameCorner = Instance.new("UICorner")
PositionsFrameCorner.CornerRadius = UDim.new(0, 8)
PositionsFrameCorner.Parent = PositionsFrame

local PositionsLabel = Instance.new("TextLabel")
PositionsLabel.Name = "PositionsLabel"
PositionsLabel.Size = UDim2.new(1, -20, 0, 20)
PositionsLabel.Position = UDim2.new(0, 10, 0, 5)
PositionsLabel.BackgroundTransparency = 1
PositionsLabel.Text = "Saved Positions"
PositionsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
PositionsLabel.TextSize = 12
PositionsLabel.Font = Enum.Font.GothamBold
PositionsLabel.Parent = PositionsFrame

local PositionsScroll = Instance.new("ScrollingFrame")
PositionsScroll.Name = "PositionsScroll"
PositionsScroll.Size = UDim2.new(1, -20, 1, -35) -- Растягивается на всю высоту PositionsFrame
PositionsScroll.Position = UDim2.new(0, 10, 0, 25)
PositionsScroll.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
PositionsScroll.BorderSizePixel = 0
PositionsScroll.ScrollBarThickness = 6
PositionsScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y -- Автоматически расширяется по содержимому
PositionsScroll.Parent = PositionsFrame

local PositionsScrollCorner = Instance.new("UICorner")
PositionsScrollCorner.CornerRadius = UDim.new(0, 6)
PositionsScrollCorner.Parent = PositionsScroll

local PositionsListLayout = Instance.new("UIListLayout")
PositionsListLayout.Padding = UDim.new(0, 5)
PositionsListLayout.Parent = PositionsScroll

-- Автоматическое обновление размера скролла
PositionsListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    PositionsScroll.CanvasSize = UDim2.new(0, 0, 0, PositionsListLayout.AbsoluteContentSize.Y)
end)

-- Хранилище позиций
local Positions = {}

-- Система сохранения данных
local DATA_KEY = "PositionManagerData"
local function SaveData()
    local data = {
        uiPosition = {MainFrame.Position.X.Scale, MainFrame.Position.X.Offset, MainFrame.Position.Y.Scale, MainFrame.Position.Y.Offset},
        uiSize = {MainFrame.Size.X.Scale, MainFrame.Size.X.Offset, MainFrame.Size.Y.Scale, MainFrame.Size.Y.Offset},
        positions = Positions
    }
    
    local success, result = pcall(function()
        return HttpService:JSONEncode(data)
    end)
    
    if success then
        pcall(function()
            local dataStore = game:GetService("DataStoreService"):GetDataStore("PositionManager")
            dataStore:SetAsync(Player.UserId .. "_" .. DATA_KEY, result)
        end)
    end
end

local function LoadData()
    local success, result = pcall(function()
        local dataStore = game:GetService("DataStoreService"):GetDataStore("PositionManager")
        return dataStore:GetAsync(Player.UserId .. "_" .. DATA_KEY)
    end)
    
    if success and result then
        local success2, data = pcall(function()
            return HttpService:JSONDecode(result)
        end)
        
        if success2 and data then
            -- Восстанавливаем позицию и размер UI
            if data.uiPosition then
                MainFrame.Position = UDim2.new(data.uiPosition[1], data.uiPosition[2], data.uiPosition[3], data.uiPosition[4])
            end
            
            if data.uiSize then
                MainFrame.Size = UDim2.new(data.uiSize[1], data.uiSize[2], data.uiSize[3], data.uiSize[4])
            end
            
            -- Восстанавливаем позиции
            if data.positions then
                Positions = data.positions
                for _, positionData in ipairs(Positions) do
                    CreatePositionEntry(positionData)
                end
            end
            
            return true
        end
    end
    return false
end

-- Функция для создания анимированного эффекта градиента
local function SetupButtonHoverEffect(button, gradient, stroke)
    local hoverTweenIn = TweenService:Create(gradient, TweenInfo.new(0.2), {Enabled = true})
    local hoverTweenOut = TweenService:Create(gradient, TweenInfo.new(0.2), {Enabled = false})
    local strokeTweenIn = TweenService:Create(stroke, TweenInfo.new(0.2), {Thickness = 2})
    local strokeTweenOut = TweenService:Create(stroke, TweenInfo.new(0.2), {Thickness = 0})
    
    button.MouseEnter:Connect(function()
        hoverTweenIn:Play()
        strokeTweenIn:Play()
    end)
    
    button.MouseLeave:Connect(function()
        hoverTweenOut:Play()
        strokeTweenOut:Play()
    end)
end

-- Функции
local function CreatePositionEntry(positionData)
    local EntryFrame = Instance.new("Frame")
    EntryFrame.Name = "EntryFrame"
    EntryFrame.Size = UDim2.new(1, 0, 0, 60)
    EntryFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    EntryFrame.BorderSizePixel = 0
    
    local EntryCorner = Instance.new("UICorner")
    EntryCorner.CornerRadius = UDim.new(0, 6)
    EntryCorner.Parent = EntryFrame
    
    local NameLabel = Instance.new("TextLabel")
    NameLabel.Name = "NameLabel"
    NameLabel.Size = UDim2.new(0.7, -5, 0, 25)
    NameLabel.Position = UDim2.new(0, 5, 0, 5)
    NameLabel.BackgroundTransparency = 1
    NameLabel.Text = positionData.Name
    NameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    NameLabel.TextSize = 12
    NameLabel.TextXAlignment = Enum.TextXAlignment.Left
    NameLabel.Parent = EntryFrame
    
    local NameBox = Instance.new("TextBox")
    NameBox.Name = "NameBox"
    NameBox.Size = UDim2.new(0.7, -5, 0, 25)
    NameBox.Position = UDim2.new(0, 5, 0, 5)
    NameBox.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    NameBox.BorderSizePixel = 0
    NameBox.Text = positionData.Name
    NameBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    NameBox.TextSize = 12
    NameBox.Visible = false
    NameBox.Parent = EntryFrame
    
    local NameBoxCorner = Instance.new("UICorner")
    NameBoxCorner.CornerRadius = UDim.new(0, 4)
    NameBoxCorner.Parent = NameBox
    
    local CoordsLabel = Instance.new("TextLabel")
    CoordsLabel.Name = "CoordsLabel"
    CoordsLabel.Size = UDim2.new(0.7, -5, 0, 25)
    CoordsLabel.Position = UDim2.new(0, 5, 0, 30)
    CoordsLabel.BackgroundTransparency = 1
    CoordsLabel.Text = string.format("X: %.1f, Y: %.1f, Z: %.1f", positionData.Position.X, positionData.Position.Y, positionData.Position.Z)
    CoordsLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    CoordsLabel.TextSize = 10
    CoordsLabel.TextXAlignment = Enum.TextXAlignment.Left
    CoordsLabel.Parent = EntryFrame
    
    local TeleportButton = Instance.new("TextButton")
    TeleportButton.Name = "TeleportButton"
    TeleportButton.Size = UDim2.new(0.3, -5, 0, 25)
    TeleportButton.Position = UDim2.new(0.7, 5, 0, 5)
    TeleportButton.BackgroundColor3 = Color3.fromRGB(70, 120, 70)
    TeleportButton.BorderSizePixel = 0
    TeleportButton.Text = "Teleport"
    TeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    TeleportButton.TextSize = 10
    TeleportButton.Parent = EntryFrame
    
    local TeleportCorner = Instance.new("UICorner")
    TeleportCorner.CornerRadius = UDim.new(0, 4)
    TeleportCorner.Parent = TeleportButton
    
    local TeleportGradient = Instance.new("UIGradient")
    TeleportGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(200, 200, 200))
    })
    TeleportGradient.Enabled = false
    TeleportGradient.Parent = TeleportButton
    
    local TeleportStroke = Instance.new("UIStroke")
    TeleportStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    TeleportStroke.Color = Color3.fromRGB(100, 200, 100)
    TeleportStroke.Thickness = 0
    TeleportStroke.Parent = TeleportButton
    
    local EditButton = Instance.new("TextButton")
    EditButton.Name = "EditButton"
    EditButton.Size = UDim2.new(0.3, -5, 0, 25)
    EditButton.Position = UDim2.new(0.7, 5, 0, 32)
    EditButton.BackgroundColor3 = Color3.fromRGB(120, 100, 70)
    EditButton.BorderSizePixel = 0
    EditButton.Text = "Edit"
    EditButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    EditButton.TextSize = 10
    EditButton.Parent = EntryFrame
    
    local EditCorner = Instance.new("UICorner")
    EditCorner.CornerRadius = UDim.new(0, 4)
    EditCorner.Parent = EditButton
    
    local EditGradient = Instance.new("UIGradient")
    EditGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(200, 200, 200))
    })
    EditGradient.Enabled = false
    EditGradient.Parent = EditButton
    
    local EditStroke = Instance.new("UIStroke")
    EditStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    EditStroke.Color = Color3.fromRGB(180, 150, 100)
    EditStroke.Thickness = 0
    EditStroke.Parent = EditButton
    
    local DeleteButton = Instance.new("TextButton")
    DeleteButton.Name = "DeleteButton"
    DeleteButton.Size = UDim2.new(0.3, -5, 0, 25)
    DeleteButton.Position = UDim2.new(0.7, 5, 0, 5) -- Та же позиция, что и TeleportButton
    DeleteButton.BackgroundColor3 = Color3.fromRGB(120, 70, 70)
    DeleteButton.BorderSizePixel = 0
    DeleteButton.Text = "Delete"
    DeleteButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    DeleteButton.TextSize = 10
    DeleteButton.Visible = false
    DeleteButton.Parent = EntryFrame
    
    local DeleteCorner = Instance.new("UICorner")
    DeleteCorner.CornerRadius = UDim.new(0, 4)
    DeleteCorner.Parent = DeleteButton
    
    local DeleteGradient = Instance.new("UIGradient")
    DeleteGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(200, 200, 200))
    })
    DeleteGradient.Enabled = false
    DeleteGradient.Parent = DeleteButton
    
    local DeleteStroke = Instance.new("UIStroke")
    DeleteStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    DeleteStroke.Color = Color3.fromRGB(200, 100, 100)
    DeleteStroke.Thickness = 0
    DeleteStroke.Parent = DeleteButton
    
    -- Настройка эффектов наведения
    SetupButtonHoverEffect(TeleportButton, TeleportGradient, TeleportStroke)
    SetupButtonHoverEffect(EditButton, EditGradient, EditStroke)
    SetupButtonHoverEffect(DeleteButton, DeleteGradient, DeleteStroke)
    
    -- Функционал кнопок
    TeleportButton.MouseButton1Click:Connect(function()
        local character = Player.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            character.HumanoidRootPart.CFrame = CFrame.new(positionData.Position)
        end
    end)
    
    local editing = false
    EditButton.MouseButton1Click:Connect(function()
        editing = not editing
        NameLabel.Visible = not editing
        NameBox.Visible = editing
        DeleteButton.Visible = editing
        TeleportButton.Visible = not editing -- Скрываем кнопку телепортации при редактировании
        EditButton.Text = editing and "Save" or "Edit"
        
        if editing then
            NameBox:CaptureFocus()
        else
            positionData.Name = NameBox.Text
            NameLabel.Text = NameBox.Text
            SavePositions()
        end
    end)
    
    DeleteButton.MouseButton1Click:Connect(function()
        for i, pos in ipairs(Positions) do
            if pos == positionData then
                table.remove(Positions, i)
                break
            end
        end
        EntryFrame:Destroy()
        SavePositions()
    end)
    
    EntryFrame.Parent = PositionsScroll
    return EntryFrame
end

local function SavePositions()
    SaveData()
    print("Positions saved:", #Positions)
end

local function LoadPositions()
    if LoadData() then
        print("Positions loaded from save")
    else
        print("No saved positions found")
    end
end

-- Обработчики событий
SaveButton.MouseButton1Click:Connect(function()
    local character = Player.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        local positionName = PositionNameBox.Text
        if positionName == "" then
            positionName = "Position " .. (#Positions + 1)
        end
        
        local positionData = {
            Name = positionName,
            Position = character.HumanoidRootPart.Position
        }
        
        table.insert(Positions, positionData)
        CreatePositionEntry(positionData)
        PositionNameBox.Text = ""
        SavePositions()
    end
end)

AddManualButton.MouseButton1Click:Connect(function()
    local x = tonumber(XBox.Text) or 0
    local y = tonumber(YBox.Text) or 0
    local z = tonumber(ZBox.Text) or 0
    local positionName = ManualNameBox.Text
    
    if positionName == "" then
        positionName = "Manual " .. (#Positions + 1)
    end
    
    local positionData = {
        Name = positionName,
        Position = Vector3.new(x, y, z)
    }
    
    table.insert(Positions, positionData)
    CreatePositionEntry(positionData)
    XBox.Text = ""
    YBox.Text = ""
    ZBox.Text = ""
    ManualNameBox.Text = ""
    SavePositions()
end)

-- Настройка эффектов наведения для основных кнопок
SetupButtonHoverEffect(SaveButton, SaveButtonGradient, SaveButtonStroke)
SetupButtonHoverEffect(AddManualButton, AddManualGradient, AddManualStroke)

-- Функционал перемещения окна
local dragging = false
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
                SaveData() -- Сохраняем позицию при завершении перемещения
            end
        end)
    end
end)

TitleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Функционал растягивания окна
local resizing = false
local resizeInput
local resizeStart
local startSize
local resizeType

for name, handle in pairs(resizeHandles) do
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            resizing = true
            resizeStart = input.Position
            startSize = MainFrame.Size
            startPos = MainFrame.Position
            resizeType = name
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    resizing = false
                    SaveData() -- Сохраняем размер при завершении растягивания
                end
            end)
        end
    end)
    
    handle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            resizeInput = input
        end
    end)
end

UserInputService.InputChanged:Connect(function(input)
    if resizing and input == resizeInput then
        local delta = input.Position - resizeStart
        local newSize = UDim2.new(startSize.X.Scale, startSize.X.Offset, startSize.Y.Scale, startSize.Y.Offset)
        local newPosition = UDim2.new(startPos.X.Scale, startPos.X.Offset, startPos.Y.Scale, startPos.Y.Offset)
        
        if resizeType:find("Left") then
            local newWidth = math.max(250, startSize.X.Offset - delta.X)
            newSize = UDim2.new(0, newWidth, newSize.Y.Scale, newSize.Y.Offset)
            newPosition = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, newPosition.Y.Scale, newPosition.Y.Offset)
        elseif resizeType:find("Right") then
            local newWidth = math.max(250, startSize.X.Offset + delta.X)
            newSize = UDim2.new(0, newWidth, newSize.Y.Scale, newSize.Y.Offset)
        end
        
        if resizeType:find("Top") then
            local newHeight = math.max(150, startSize.Y.Offset - delta.Y)
            newSize = UDim2.new(newSize.X.Scale, newSize.X.Offset, 0, newHeight)
            newPosition = UDim2.new(newPosition.X.Scale, newPosition.X.Offset, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        elseif resizeType:find("Bottom") then
            local newHeight = math.max(150, startSize.Y.Offset + delta.Y)
            newSize = UDim2.new(newSize.X.Scale, newSize.X.Offset, 0, newHeight)
        end
        
        MainFrame.Size = newSize
        MainFrame.Position = newPosition
    end
end)

-- Сворачивание/разворачивание
local minimized = false
MinimizeButton.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        MainFrame.Size = UDim2.new(0, 300, 0, 30)
        MinimizeButton.Text = "+"
    else
        MainFrame.Size = UDim2.new(0, 300, 0, 400)
        MinimizeButton.Text = "_"
    end
    SaveData()
end)

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Автоматическое сохранение каждые 30 секунд
local autoSaveConnection
autoSaveConnection = RunService.Heartbeat:Connect(function()
    wait(30)
    SaveData()
end)

-- Загрузка сохраненных позиций при старте
LoadPositions()

-- Обработка выхода из игры
game:BindToClose(function()
    SaveData()
end)
