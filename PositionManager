local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- Основной GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PositionManager"
ScreenGui.Parent = Player.PlayerGui

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 300, 0, 400)
MainFrame.Position = UDim2.new(0, 50, 0, 50)
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

-- Заголовок для перемещения
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Size = UDim2.new(0.7, 0, 1, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "Position Manager"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextSize = 14
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.Parent = TitleBar

local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -60, 0, 0)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Text = "_"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.TextSize = 16
MinimizeButton.Parent = TitleBar

local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -30, 0, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.BorderSizePixel = 0
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 12
CloseButton.Parent = TitleBar

-- Контент
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, 0, 1, -30)
ContentFrame.Position = UDim2.new(0, 0, 0, 30)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- Секция сохранения позиции
local SaveSection = Instance.new("Frame")
SaveSection.Name = "SaveSection"
SaveSection.Size = UDim2.new(1, -20, 0, 100)
SaveSection.Position = UDim2.new(0, 10, 0, 10)
SaveSection.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
SaveSection.BorderSizePixel = 0
SaveSection.Parent = ContentFrame

local SaveSectionCorner = Instance.new("UICorner")
SaveSectionCorner.CornerRadius = UDim.new(0, 6)
SaveSectionCorner.Parent = SaveSection

local PositionNameBox = Instance.new("TextBox")
PositionNameBox.Name = "PositionNameBox"
PositionNameBox.Size = UDim2.new(1, -20, 0, 30)
PositionNameBox.Position = UDim2.new(0, 10, 0, 10)
PositionNameBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
PositionNameBox.BorderSizePixel = 0
PositionNameBox.PlaceholderText = "Position Name"
PositionNameBox.Text = ""
PositionNameBox.TextColor3 = Color3.fromRGB(255, 255, 255)
PositionNameBox.TextSize = 12
PositionNameBox.Parent = SaveSection

local SaveButton = Instance.new("TextButton")
SaveButton.Name = "SaveButton"
SaveButton.Size = UDim2.new(1, -20, 0, 30)
SaveButton.Position = UDim2.new(0, 10, 0, 50)
SaveButton.BackgroundColor3 = Color3.fromRGB(60, 120, 60)
SaveButton.BorderSizePixel = 0
SaveButton.Text = "Save Current Position"
SaveButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SaveButton.TextSize = 12
SaveButton.Parent = SaveSection

-- Секция ручного ввода координат
local ManualSection = Instance.new("Frame")
ManualSection.Name = "ManualSection"
ManualSection.Size = UDim2.new(1, -20, 0, 130)
ManualSection.Position = UDim2.new(0, 10, 0, 120)
ManualSection.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
ManualSection.BorderSizePixel = 0
ManualSection.Parent = ContentFrame

local ManualSectionCorner = Instance.new("UICorner")
ManualSectionCorner.CornerRadius = UDim.new(0, 6)
ManualSectionCorner.Parent = ManualSection

local ManualLabel = Instance.new("TextLabel")
ManualLabel.Name = "ManualLabel"
ManualLabel.Size = UDim2.new(1, -20, 0, 20)
ManualLabel.Position = UDim2.new(0, 10, 0, 5)
ManualLabel.BackgroundTransparency = 1
ManualLabel.Text = "Manual Coordinates"
ManualLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
ManualLabel.TextSize = 12
ManualLabel.Font = Enum.Font.GothamBold
ManualLabel.Parent = ManualSection

local XBox = Instance.new("TextBox")
XBox.Name = "XBox"
XBox.Size = UDim2.new(0.32, 0, 0, 30)
XBox.Position = UDim2.new(0, 10, 0, 30)
XBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
XBox.BorderSizePixel = 0
XBox.PlaceholderText = "X"
XBox.Text = ""
XBox.TextColor3 = Color3.fromRGB(255, 255, 255)
XBox.TextSize = 12
XBox.Parent = ManualSection

local YBox = Instance.new("TextBox")
YBox.Name = "YBox"
YBox.Size = UDim2.new(0.32, 0, 0, 30)
YBox.Position = UDim2.new(0.34, 10, 0, 30)
YBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
YBox.BorderSizePixel = 0
YBox.PlaceholderText = "Y"
YBox.Text = ""
YBox.TextColor3 = Color3.fromRGB(255, 255, 255)
YBox.TextSize = 12
YBox.Parent = ManualSection

local ZBox = Instance.new("TextBox")
ZBox.Name = "ZBox"
ZBox.Size = UDim2.new(0.32, 0, 0, 30)
ZBox.Position = UDim2.new(0.68, -10, 0, 30)
ZBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
ZBox.BorderSizePixel = 0
ZBox.PlaceholderText = "Z"
ZBox.Text = ""
ZBox.TextColor3 = Color3.fromRGB(255, 255, 255)
ZBox.TextSize = 12
ZBox.Parent = ManualSection

local ManualNameBox = Instance.new("TextBox")
ManualNameBox.Name = "ManualNameBox"
ManualNameBox.Size = UDim2.new(1, -20, 0, 30)
ManualNameBox.Position = UDim2.new(0, 10, 0, 65)
ManualNameBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
ManualNameBox.BorderSizePixel = 0
ManualNameBox.PlaceholderText = "Position Name"
ManualNameBox.Text = ""
ManualNameBox.TextColor3 = Color3.fromRGB(255, 255, 255)
ManualNameBox.TextSize = 12
ManualNameBox.Parent = ManualSection

local AddManualButton = Instance.new("TextButton")
AddManualButton.Name = "AddManualButton"
AddManualButton.Size = UDim2.new(1, -20, 0, 30)
AddManualButton.Position = UDim2.new(0, 10, 0, 100)
AddManualButton.BackgroundColor3 = Color3.fromRGB(60, 100, 150)
AddManualButton.BorderSizePixel = 0
AddManualButton.Text = "Add Manual Position"
AddManualButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AddManualButton.TextSize = 12
AddManualButton.Parent = ManualSection

-- Список позиций
local PositionsFrame = Instance.new("Frame")
PositionsFrame.Name = "PositionsFrame"
PositionsFrame.Size = UDim2.new(1, -20, 0, 200)
PositionsFrame.Position = UDim2.new(0, 10, 0, 260)
PositionsFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
PositionsFrame.BorderSizePixel = 0
PositionsFrame.Parent = ContentFrame

local PositionsFrameCorner = Instance.new("UICorner")
PositionsFrameCorner.CornerRadius = UDim.new(0, 6)
PositionsFrameCorner.Parent = PositionsFrame

local PositionsLabel = Instance.new("TextLabel")
PositionsLabel.Name = "PositionsLabel"
PositionsLabel.Size = UDim2.new(1, -20, 0, 20)
PositionsLabel.Position = UDim2.new(0, 10, 0, 5)
PositionsLabel.BackgroundTransparency = 1
PositionsLabel.Text = "Saved Positions"
PositionsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
PositionsLabel.TextSize = 12
PositionsLabel.Font = Enum.Font.GothamBold
PositionsLabel.Parent = PositionsFrame

local PositionsScroll = Instance.new("ScrollingFrame")
PositionsScroll.Name = "PositionsScroll"
PositionsScroll.Size = UDim2.new(1, -20, 1, -35)
PositionsScroll.Position = UDim2.new(0, 10, 0, 25)
PositionsScroll.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
PositionsScroll.BorderSizePixel = 0
PositionsScroll.ScrollBarThickness = 6
PositionsScroll.Parent = PositionsFrame

local PositionsListLayout = Instance.new("UIListLayout")
PositionsListLayout.Parent = PositionsScroll

-- Хранилище позиций
local Positions = {}

-- Функции
local function CreatePositionEntry(positionData)
    local EntryFrame = Instance.new("Frame")
    EntryFrame.Name = "EntryFrame"
    EntryFrame.Size = UDim2.new(1, 0, 0, 60)
    EntryFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    EntryFrame.BorderSizePixel = 0
    
    local EntryCorner = Instance.new("UICorner")
    EntryCorner.CornerRadius = UDim.new(0, 4)
    EntryCorner.Parent = EntryFrame
    
    local NameLabel = Instance.new("TextLabel")
    NameLabel.Name = "NameLabel"
    NameLabel.Size = UDim2.new(0.7, -5, 0, 25)
    NameLabel.Position = UDim2.new(0, 5, 0, 5)
    NameLabel.BackgroundTransparency = 1
    NameLabel.Text = positionData.Name
    NameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    NameLabel.TextSize = 12
    NameLabel.TextXAlignment = Enum.TextXAlignment.Left
    NameLabel.Parent = EntryFrame
    
    local NameBox = Instance.new("TextBox")
    NameBox.Name = "NameBox"
    NameBox.Size = UDim2.new(0.7, -5, 0, 25)
    NameBox.Position = UDim2.new(0, 5, 0, 5)
    NameBox.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    NameBox.BorderSizePixel = 0
    NameBox.Text = positionData.Name
    NameBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    NameBox.TextSize = 12
    NameBox.Visible = false
    NameBox.Parent = EntryFrame
    
    local CoordsLabel = Instance.new("TextLabel")
    CoordsLabel.Name = "CoordsLabel"
    CoordsLabel.Size = UDim2.new(0.7, -5, 0, 25)
    CoordsLabel.Position = UDim2.new(0, 5, 0, 30)
    CoordsLabel.BackgroundTransparency = 1
    CoordsLabel.Text = string.format("X: %.1f, Y: %.1f, Z: %.1f", positionData.Position.X, positionData.Position.Y, positionData.Position.Z)
    CoordsLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    CoordsLabel.TextSize = 10
    CoordsLabel.TextXAlignment = Enum.TextXAlignment.Left
    CoordsLabel.Parent = EntryFrame
    
    local TeleportButton = Instance.new("TextButton")
    TeleportButton.Name = "TeleportButton"
    TeleportButton.Size = UDim2.new(0.3, -5, 0, 25)
    TeleportButton.Position = UDim2.new(0.7, 5, 0, 5)
    TeleportButton.BackgroundColor3 = Color3.fromRGB(70, 120, 70)
    TeleportButton.BorderSizePixel = 0
    TeleportButton.Text = "Teleport"
    TeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    TeleportButton.TextSize = 10
    TeleportButton.Parent = EntryFrame
    
    local EditButton = Instance.new("TextButton")
    EditButton.Name = "EditButton"
    EditButton.Size = UDim2.new(0.3, -5, 0, 25)
    EditButton.Position = UDim2.new(0.7, 5, 0, 32)
    EditButton.BackgroundColor3 = Color3.fromRGB(120, 100, 70)
    EditButton.BorderSizePixel = 0
    EditButton.Text = "Edit"
    EditButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    EditButton.TextSize = 10
    EditButton.Parent = EntryFrame
    
    local DeleteButton = Instance.new("TextButton")
    DeleteButton.Name = "DeleteButton"
    DeleteButton.Size = UDim2.new(1, -10, 0, 20)
    DeleteButton.Position = UDim2.new(0, 5, 1, -25)
    DeleteButton.BackgroundColor3 = Color3.fromRGB(120, 70, 70)
    DeleteButton.BorderSizePixel = 0
    DeleteButton.Text = "Delete"
    DeleteButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    DeleteButton.TextSize = 10
    DeleteButton.Visible = false
    DeleteButton.Parent = EntryFrame
    
    -- Функционал кнопок
    TeleportButton.MouseButton1Click:Connect(function()
        local character = Player.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            character.HumanoidRootPart.CFrame = CFrame.new(positionData.Position)
        end
    end)
    
    local editing = false
    EditButton.MouseButton1Click:Connect(function()
        editing = not editing
        NameLabel.Visible = not editing
        NameBox.Visible = editing
        DeleteButton.Visible = editing
        EditButton.Text = editing and "Save" or "Edit"
        
        if editing then
            NameBox:CaptureFocus()
        else
            positionData.Name = NameBox.Text
            NameLabel.Text = NameBox.Text
            SavePositions()
        end
    end)
    
    DeleteButton.MouseButton1Click:Connect(function()
        for i, pos in ipairs(Positions) do
            if pos == positionData then
                table.remove(Positions, i)
                break
            end
        end
        EntryFrame:Destroy()
        SavePositions()
    end)
    
    EntryFrame.Parent = PositionsScroll
    return EntryFrame
end

local function SavePositions()
    -- В реальной игре здесь можно сохранять в DataStore
    print("Positions saved:", #Positions)
end

local function LoadPositions()
    -- В реальной игре здесь можно загружать из DataStore
    print("Positions loaded")
end

-- Обработчики событий
SaveButton.MouseButton1Click:Connect(function()
    local character = Player.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        local positionName = PositionNameBox.Text
        if positionName == "" then
            positionName = "Position " .. (#Positions + 1)
        end
        
        local positionData = {
            Name = positionName,
            Position = character.HumanoidRootPart.Position
        }
        
        table.insert(Positions, positionData)
        CreatePositionEntry(positionData)
        PositionNameBox.Text = ""
        SavePositions()
    end
end)

AddManualButton.MouseButton1Click:Connect(function()
    local x = tonumber(XBox.Text) or 0
    local y = tonumber(YBox.Text) or 0
    local z = tonumber(ZBox.Text) or 0
    local positionName = ManualNameBox.Text
    
    if positionName == "" then
        positionName = "Manual " .. (#Positions + 1)
    end
    
    local positionData = {
        Name = positionName,
        Position = Vector3.new(x, y, z)
    }
    
    table.insert(Positions, positionData)
    CreatePositionEntry(positionData)
    XBox.Text = ""
    YBox.Text = ""
    ZBox.Text = ""
    ManualNameBox.Text = ""
    SavePositions()
end)

-- Функционал перемещения окна
local dragging = false
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

TitleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Сворачивание/разворачивание
local minimized = false
MinimizeButton.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        MainFrame.Size = UDim2.new(0, 300, 0, 30)
        MinimizeButton.Text = "+"
    else
        MainFrame.Size = UDim2.new(0, 300, 0, 400)
        MinimizeButton.Text = "_"
    end
end)

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Загрузка сохраненных позиций
LoadPositions()

-- Обновление списка позиций
for _, positionData in ipairs(Positions) do
    CreatePositionEntry(positionData)
end
